(function(){"use strict";let r=5,l=JSON.parse(localStorage.getItem("invest_v22"))||[],i=parseInt(localStorage.getItem("target_v22"))||1e6,c,b=null;function T(){if(l.length===0)return alert("ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");let t="\uFEFF";t+=`[CONFIG],ëª©í‘œê¸ˆì•¡,${i},ì‹œìž‘ê¸ˆì•¡,${l.length>0?l[0].balance:0},,,, 
`,t+=`ì¼ìž,ì¢…ëª©ëª…,ë§¤ìˆ˜ê¸ˆì•¡,ë§¤ë„ê¸ˆì•¡,ìˆ˜ìµê¸ˆ,ìˆ˜ìµë¥ ,ìµœì¢…ìž”ê³ 
`,l.forEach(e=>{const s=e.isSeed?0:e.sellAmount-e.buyAmount,a=e.isSeed||e.buyAmount===0?0:(s/e.buyAmount*100).toFixed(2);t+=`${e.isSeed?"ì‹œìž‘":e.date},${e.ticker},${e.buyAmount},${e.sellAmount},${s},${a}%,${e.balance}
`});const n=new Blob([t],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=`OLLIM_DATA_${new Date().toISOString().split("T")[0]}.csv`,o.click()}function k(t){const n=t.files[0];if(!n||l.length>0&&!confirm("ê¸°ì¡´ ë°ì´í„°ê°€ ì‚­ì œë˜ê³  íŒŒì¼ ë‚´ìš©ìœ¼ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤. ì§„í–‰í• ê¹Œìš”?"))return;const o=new FileReader;o.onload=function(e){const a=e.target.result.split(`
`),m=[];if(a[0].startsWith("[CONFIG]")){const u=a[0].split(","),d=parseInt(u[2]);parseInt(u[4]),isNaN(d)||(i=d,localStorage.setItem("target_v22",i))}a.slice(2).forEach(u=>{if(!u.trim())return;const d=u.split(","),B=d[0]==="ì‹œìž‘";m.push({date:B?"1900-01-01":d[0],ticker:d[1],buyAmount:parseInt(d[2])||0,sellAmount:parseInt(d[3])||0,balance:parseInt(d[6])||0,isSeed:B})}),m.length>0&&(l=m,p(),alert("ë°ì´í„°, ëª©í‘œ ê¸ˆì•¡, ì‹œìž‘ ê¸ˆì•¡ì„ ëª¨ë‘ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤."),location.reload())},o.readAsText(n)}function h(){if(l.length!==0){l.sort((t,n)=>new Date(t.date)-new Date(n.date));for(let t=1;t<l.length;t++)l[t].balance=l[t-1].balance+(l[t].sellAmount-l[t].buyAmount)}}function L(){if(l.length===0)return;const t=l[0].balance,n=l[l.length-1].balance,o=Math.min((n-t)/(i-t)*100,100);let e="ðŸ£ ì•Œì„ ê¹¨ëŠ” ì¤‘";o>=100?e="ðŸ‘‘ ìžì‚°ì˜ ì§€ë°°ìž":o>=80?e="ðŸ”¥ ëª©í‘œ ë„ë‹¬ ì§ì „":o>=50?e="âš¡ í™•ì‹ ì˜ ë§¤ë§¤ë²•":o>=20&&(e="ðŸŒŠ íë¦„ì„ íƒ€ëŠ” ì¤‘"),document.getElementById("user-rank").innerText=e,document.getElementById("progress-bar").style.width=Math.max(1,o)+"%",document.getElementById("start-label").innerText=`ST: ${t.toLocaleString()}`,document.getElementById("target-label").innerText=`GOAL: ${i.toLocaleString()}`,document.getElementById("current-balance").innerText=n.toLocaleString()+"ì›",document.getElementById("progress-percent").innerText=Math.floor(o)+"%",document.getElementById("user-level-badge").innerText=`LV.${Math.floor(o/20)+1}`}function y(){const t=document.getElementById("mobile-trade-history");let n="";[...l].reverse().slice(0,r).map(e=>{const s=l.indexOf(e),a=e.isSeed?0:e.sellAmount-e.buyAmount,m=e.isSeed||e.buyAmount===0?0:(a/e.buyAmount*100).toFixed(2),f=a>0?"text-red-500":a<0?"text-blue-500":"text-slate-400";n+=`<div class="glass-card p-4 rounded-2xl border-l-4 mb-4 ${e.isSeed?"border-l-slate-400":a>=0?"border-l-red-500":"border-l-blue-500"} animate-modal shadow-sm">
            <div class="flex justify-between items-start">
                <div><span class="text-[11px] text-slate-400 font-bold uppercase">${e.isSeed?"START":e.date}</span><h3 class="font-bold text-base">${e.ticker}</h3></div>
                ${e.isSeed?"":`<button onclick="openModal('delete', ${s})" class="p-2 text-slate-300">âœ•</button>`}
            </div>
            <div class="grid grid-cols-3 gap-1 mt-4 pt-3 border-t border-slate-100 dark:border-slate-800 text-center">
                <div><p class="text-[10px] text-slate-400 font-bold uppercase">Trade</p><p class="text-[10px] text-slate-500">B: ${e.isSeed?"-":e.buyAmount.toLocaleString()}</p><p class="text-[10px] text-slate-500">S: ${e.isSeed?"-":e.sellAmount.toLocaleString()}</p></div>
                <div class="border-x border-slate-100 dark:border-slate-800 flex flex-col justify-center"><p class="text-[10px] text-slate-400 font-bold uppercase">Profit</p><p class="text-[11px] font-black ${f}">${e.isSeed?"-":(a>0?"+":"")+a.toLocaleString()}</p><p class="text-[9px] font-bold ${f}">${e.isSeed?"":"("+(a>0?"+":"")+m+"%)"}</p></div>
                <div class="flex flex-col justify-center"><p class="text-[10px] text-slate-400 font-bold uppercase">Balance</p><p class="text-[11px] font-black text-emerald-500">${e.balance.toLocaleString()}</p></div>
            </div>
        </div>`}),t.innerHTML=n,w()}function w(){const t=document.getElementById("mobile-trade-history");if(l.length<=5)return;const n=document.createElement("button");n.className="w-full py-6 mt-2 mb-10 text-[11px] font-black text-slate-400 hover:text-blue-500 transition-all uppercase tracking-widest",r<l.length?(n.innerHTML=`Load More Records (${r} / ${l.length}) <br> <span class="text-[15px]">â–¾</span>`,n.onclick=()=>{r+=5,y(),window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}):(n.innerHTML='Close Records (Show First 5) <br> <span class="text-[15px]">â–´</span>',n.onclick=()=>{r=5,y(),document.getElementById("mobile-trade-history").scrollIntoView({behavior:"smooth"})}),t.appendChild(n)}function A(){const t=document.getElementById("ticker").value,n=parseInt(document.getElementById("buy-amount-input").value),o=parseInt(document.getElementById("sell-amount-input").value),e=document.getElementById("trade-date").value;if(!t||isNaN(n)||isNaN(o)||!e)return alert("ìž…ë ¥ í™•ì¸!");l.push({date:e,ticker:t,buyAmount:n,sellAmount:o,balance:0,isSeed:!1}),h(),p(),document.getElementById("ticker").value="",document.getElementById("buy-amount-input").value="",document.getElementById("sell-amount-input").value=""}function p(){localStorage.setItem("invest_v22",JSON.stringify(l)),I()}function x(t,n=null){const o=document.getElementById("confirm-modal"),e=document.getElementById("modal-confirm-btn");t==="reset"?(document.getElementById("modal-icon").innerHTML="âš ï¸",document.getElementById("modal-title").innerText="ì „ì²´ ì´ˆê¸°í™”",document.getElementById("modal-desc").innerText="ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.",e.innerText="ì´ˆê¸°í™”",e.className="flex-1 bg-red-600 text-white font-bold py-3 rounded-xl text-sm active:scale-95 transition-all",e.onclick=()=>{localStorage.clear(),location.reload()}):(b=n,document.getElementById("modal-icon").innerHTML="ðŸ—‘ï¸",document.getElementById("modal-title").innerText="ê¸°ë¡ ì‚­ì œ",document.getElementById("modal-desc").innerText="ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",e.innerText="ì‚­ì œ",e.className="flex-1 bg-slate-800 text-white font-bold py-3 rounded-xl text-sm active:scale-95 transition-all",e.onclick=()=>{l.splice(b,1),h(),p(),v()}),o.classList.remove("hidden"),document.body.style.overflow="hidden"}function v(){document.getElementById("confirm-modal").classList.add("hidden"),document.body.style.overflow=""}function $(){x("reset")}function M(){const t=document.getElementById("equityChart").getContext("2d");c=new Chart(t,{type:"line",data:{labels:l.map(n=>n.isSeed?"ì‹œìž‘":n.date),datasets:[{data:l.map(n=>n.balance),borderColor:"#3b82f6",borderWidth:3,pointRadius:2,fill:!0,backgroundColor:"rgba(59, 130, 246, 0.05)",tension:.4}]},options:{maintainAspectRatio:!1,scales:{y:{ticks:{font:{size:9}}},x:{ticks:{font:{size:9}}}},plugins:{legend:{display:!1}}}})}function C(){c.data.labels=l.map(t=>t.isSeed?"ì‹œìž‘":t.date),c.data.datasets[0].data=l.map(t=>t.balance),c.update()}function I(){L(),c?C():M(),y()}function N(){const t=document.documentElement.classList.toggle("light-mode");localStorage.setItem("theme_v22",t?"light":"dark"),E(),c&&c.update()}function R(){localStorage.getItem("theme_v22")==="light"?document.documentElement.classList.add("light-mode"):document.documentElement.classList.remove("light-mode"),E()}function E(){const t=document.documentElement.classList.contains("light-mode");document.getElementById("theme-icon").innerText=t?"â˜€ï¸":"ðŸŒ™",document.getElementById("theme-text").innerText=t?"Light Mode":"Dark Mode"}function _(){const t=parseInt(document.getElementById("initial-input").value),n=parseInt(document.getElementById("target-input").value);if(!t||!n)return alert("ê¸ˆì•¡ì„ ìž…ë ¥í•˜ì„¸ìš”.");i=n,localStorage.setItem("target_v22",n),l.push({date:"1900-01-01",ticker:"ì¢…ëª©ëª…",buyAmount:0,sellAmount:0,balance:t,isSeed:!0}),p(),document.getElementById("setup-modal").classList.add("hidden"),document.getElementById("main").classList.remove("hidden")}function j(){document.getElementById("pass-input").value===D?(sessionStorage.setItem("ollim_auth","true"),document.getElementById("auth-overlay").style.display="none",S()):alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.")}function F(){sessionStorage.getItem("ollim_auth")==="true"?(document.getElementById("auth-overlay").style.display="none",S()):document.getElementById("auth-overlay").style.display="flex"}function S(){l.length===0?(console.log("ã…Žã…Ž"),document.getElementById("setup-modal").classList.remove("hidden")):(document.getElementById("main").classList.remove("hidden"),I())}window.onload=()=>{R(),F()},document.getElementById("trade-date").valueAsDate=new Date,document.querySelector(".js-openResetModal").addEventListener("click",$),document.querySelector(".js-addTrade").addEventListener("click",A),document.querySelector(".js-closeModal").addEventListener("click",v),document.querySelector(".js-exportCSV").addEventListener("click",T),document.querySelector(".js-toggleTheme").addEventListener("click",N),document.querySelector(".js-saveInitialSetup").addEventListener("click",_),document.getElementById("import-csv").addEventListener("change",function(){k(this)}),document.querySelector(".js-verifyPassword").addEventListener("click",j);const D="1234",g=document.getElementById("guideModal"),O=document.getElementById("guideBtn"),q=document.getElementsByClassName("ollim-close")[0];O.onclick=()=>{g.style.display="block",document.body.style.overflow="hidden"},q.onclick=()=>{g.style.display="none",document.body.style.overflow=""},window.onclick=t=>{t.target==g&&(g.style.display="none",document.body.style.overflow="")};function H(t,n){var o,e,s;for(e=document.getElementsByClassName("tab-content"),o=0;o<e.length;o++)e[o].style.display="none";for(s=document.getElementsByClassName("tab-link"),o=0;o<s.length;o++)s[o].className=s[o].className.replace(" active","");document.getElementById(n).style.display="block",t.currentTarget.className+=" active"}window.openModal=x,window.openTab=H})();
